{"version":3,"sources":["components/useIntersect.js","components/ItemListHomeDisplay.js","components/App.js","index.js"],"names":["baseOption","root","threshold","rootMargin","useIntersect","onIntersect","option","useState","ref","setRef","checkIntersect","useCallback","observer","entry","isIntersecting","useEffect","IntersectionObserver","observe","disconnect","propList","title","price","link","description","imageLink","useStyles","makeStyles","theme","display","justifyContent","padding","borderStyle","borderWidth","borderColor","boxShadow","marginBottom","spacing","textAlign","details","overflow","overflowWrap","content","flex","cover","minWidth","backgroundColor","borderLeft","edit","FEED_QUERY","gql","ADD_ITEM_MUTATION","REMOVE_ITEM_MUTATION","TaoItem","item","refresh","classes","useMutation","removeItem","onRemoveButtonClick","a","variables","id","data","style","Button","width","height","onClick","marginLeft","Card","className","str","RegExp","test","window","open","CardContent","Typography","component","variant","length","color","CardMedia","image","initialState","JSON","parse","stringify","formReducer","state","action","type","produce","draft","_","set","path","value","Field","prop","formState","updateForm","name","attr","Array","isArray","map","i","TextField","label","fullWidth","size","onChange","get","Form","React","memo","Object","entries","NewItem","addItem","useReducer","formDispatch","target","submitForm","submit","Number","float","ItemListDisplay","refetch","onLoadMore","isEdit","unobserve","itemList","batchItem","ItemListHomeDisplay","prevCount","useQuery","loading","error","fetchMore","useLocation","pathname","count","start","updateQuery","prev","fetchMoreResult","assign","createMuiTheme","typography","fontFamily","join","AUTH_CHECK","LOGIN","Login","login","e","preventDefault","elements","username","pw","pwd","res","expires","Date","setTime","getTime","Cookies","token","location","href","alert","onSubmit","d","loginRequest","placeholder","UserAuth","createContext","App","authCheck","auth","setAuth","isLogin","Home","Container","maxWidth","Box","alignItems","to","ThemeProvider","Provider","exact","authorization","httpLink","createHttpLink","uri","credentials","headers","Authorization","client","ApolloClient","cache","InMemoryCache","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.69500217.chunk.js","sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\r\n\r\nconst baseOption = {\r\n  root: null,\r\n  threshold: 0.5,\r\n  rootMargin: \"0px\"\r\n};\r\nconst useIntersect = (onIntersect, option) => {\r\n  const [ref, setRef] = useState(null);\r\n  const checkIntersect = useCallback(([entry], observer) => {\r\n    if (entry.isIntersecting) {\r\n      onIntersect(entry, observer);\r\n    }\r\n  }, []);\r\n  useEffect(() => {\r\n    let observer;\r\n    if (ref) {\r\n      observer = new IntersectionObserver(checkIntersect, {\r\n        ...baseOption,\r\n        ...option\r\n      });\r\n      observer.observe(ref);\r\n    }\r\n    return () => observer && observer.disconnect();\r\n  }, [ref, option.root, option.threshold, option.rootMargin, checkIntersect]);\r\n  return [ref, setRef];\r\n};\r\n\r\nexport default useIntersect;\r\n","import { Button, Card, CardContent, CardMedia, makeStyles, TextField, Typography } from \"@material-ui/core\";\r\nimport { gql } from \"apollo-boost\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { Query, useMutation, useQuery } from \"react-apollo\";\r\nimport React from 'react';\r\nimport produce from 'immer';\r\nimport _, { get, set } from 'lodash';\r\nimport { useLocation } from 'react-router-dom';\r\nimport useIntersect from './useIntersect';\r\n\r\n\r\nconst propList = {\r\n  title: '',\r\n  price: [null, null],\r\n  link: '',\r\n  description: '',\r\n  imageLink: ''\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n      display: 'flex',\r\n      justifyContent: 'space-between',\r\n      padding: 0,\r\n      borderStyle: 'solid',\r\n      borderWidth: '1px',\r\n      borderColor: 'rgba(0, 0, 0, 0.23)',\r\n      boxShadow: 'none',\r\n      marginBottom: theme.spacing(1),\r\n      textAlign: 'left'\r\n  },\r\n  details: {\r\n    overflow: 'hidden',\r\n    overflowWrap: 'break-word'\r\n  },\r\n  content: {\r\n      padding: theme.spacing(1),\r\n      flex: '1 0 auto'\r\n  },\r\n  cover: {\r\n      minWidth: 150,\r\n      backgroundColor: 'white',\r\n      borderLeft: '1px solid rgba(0, 0, 0, 0.23)',\r\n  },\r\n  edit: {\r\n    padding: 0,\r\n    borderStyle: 'solid',\r\n    borderWidth: '1px',\r\n    borderColor: 'rgba(0, 0, 0, 0.23)',\r\n    boxShadow: 'none',\r\n    marginBottom: theme.spacing(1),\r\n    textAlign: 'left'\r\n},\r\n}));\r\n\r\nfunction validURL(str) {\r\n  var pattern = new RegExp('^(https?:\\\\/\\\\/)?'+ // protocol\r\n    '((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|'+ // domain name\r\n    '((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))'+ // OR ip (v4) address\r\n    '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*'+ // port and path\r\n    '(\\\\?[;&a-z\\\\d%_.~+=-]*)?'+ // query string\r\n    '(\\\\#[-a-z\\\\d_]*)?$','i'); // fragment locator\r\n  return !!pattern.test(str);\r\n}\r\n\r\nconst FEED_QUERY = gql`\r\n  query batchItem($start: Int) {\r\n    batchItem(start: $start) {\r\n      id\r\n      title\r\n      price\r\n      link\r\n      description\r\n      imageLink\r\n    }\r\n  }\r\n`\r\n\r\nconst ADD_ITEM_MUTATION = gql`\r\n  mutation addItem($title: String!, $price: [Float!]!, $link: String!, $description: String!, $imageLink: String!) {\r\n    addItem(\r\n      title: $title,\r\n      price: $price,\r\n      link: $link,\r\n      description: $description,\r\n      imageLink: $imageLink\r\n    )\r\n  }\r\n`\r\n\r\nconst REMOVE_ITEM_MUTATION = gql`\r\n  mutation removeItem($id: String!) {\r\n    removeItem(\r\n      id: $id\r\n    )\r\n  }\r\n`\r\n\r\nconst TaoItem = ({ item, edit, refresh }) => {\r\n  const classes = useStyles();\r\n\r\n  const [removeItem] = useMutation(REMOVE_ITEM_MUTATION);\r\n\r\n\r\n  const onClick = () => {\r\n    if (!validURL(item.link)) return;\r\n    window.open(item.link, \"_blank\")\r\n  }\r\n\r\n  const onRemoveButtonClick = async () => {\r\n    let { data } = await removeItem({ variables: { id: item.id } });\r\n    if (!data.removeItem) return;\r\n    refresh();\r\n  }\r\n\r\n  const onEditButtonClick = () => {\r\n\r\n  }\r\n\r\n  return (\r\n    <>\r\n      { edit && <div style={{marginBottom: 3, textAlign: 'right'}}>\r\n        <Button style={{backgroundColor:'lightblue', width: '20px !important', height: 20}}> EDIT </Button>\r\n        <Button onClick={onRemoveButtonClick} style={{backgroundColor:'lightsalmon', width: '20px !important', height: 20, marginLeft: 3}}> X </Button>\r\n      </div> }\r\n      <Card className={classes.root} onClick={onClick}>\r\n        <div className={classes.details}>\r\n          <CardContent className={classes.content}>\r\n              <Typography component=\"h6\" variant=\"h6\">\r\n                  {item.title}\r\n              </Typography>\r\n              <Typography>\r\n                  {item.price.length <= 1 ? \r\n                    `${item.price[0]}¥` :\r\n                    `${item.price[0]}-${item.price[1]}¥`\r\n                  }\r\n              </Typography>\r\n              <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n                  {item.description}\r\n              </Typography>\r\n          </CardContent>\r\n        </div>\r\n        <CardMedia\r\n            className={classes.cover}\r\n            image={item.imageLink || 'https://via.placeholder.com/150x150?text=No+Image'}\r\n        />\r\n      </Card>\r\n    </>\r\n  )\r\n}\r\n\r\nconst initialState = JSON.parse(JSON.stringify(propList));\r\n\r\nconst formReducer = (state, action) => {\r\n  switch (action.type) {\r\n      case 'UPDATE':\r\n        return produce(state, draft => {\r\n          _.set(draft, ...[action.path, action.value])\r\n        });\r\n      case 'RESET':\r\n        return initialState;\r\n      default:\r\n          return state;\r\n  }\r\n}\r\n\r\nconst Field = ({prop, formState, updateForm}) => {\r\n  const [name, attr] = prop;\r\n  \r\n  if (Array.isArray(attr)) return (\r\n    <div style={{display: 'flex'}}>\r\n      {attr.map((_, i) => (\r\n        <TextField\r\n          name={`${name}[${i}]`}\r\n          label={`${name} ${i}`}\r\n          key={`${name}[${i}]`}\r\n          fullWidth\r\n          variant=\"outlined\"\r\n          size='small'\r\n          style={{marginBottom:5}}\r\n          onChange={updateForm}\r\n          value={get(formState, `${name}[${i}]`)}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <TextField\r\n        name={name}\r\n        label={name}\r\n        key={name}\r\n        fullWidth\r\n        variant=\"outlined\"\r\n        size='small'\r\n        style={{marginBottom:5}}\r\n        onChange={updateForm}\r\n        value={get(formState, `${name}`)}\r\n      />\r\n  );\r\n}\r\n\r\nconst Form = React.memo(function Form({formState, updateForm}) {\r\n  return (\r\n    Object.entries(propList).map((prop, i)=><Field prop={prop} formState={formState} updateForm={updateForm} key={i}/>)\r\n  )\r\n})\r\n\r\n\r\nconst NewItem = ({ refresh }) => {\r\n\r\n  const classes = useStyles();\r\n\r\n  const [addItem] = useMutation(ADD_ITEM_MUTATION);\r\n\r\n  const [formState, formDispatch] = React.useReducer(formReducer, initialState);\r\n\r\n  const updateForm = React.useCallback(({ target: { value, name, type } }) => {\r\n    formDispatch({\r\n        type: 'UPDATE',\r\n        path: name,\r\n        value: value\r\n    })\r\n  }, []);\r\n\r\n  const submitForm = async () => {\r\n    let submit = JSON.parse(JSON.stringify(formState));\r\n    submit.price[0] = Number(submit.price[0]);\r\n    if (submit.price[1]) {\r\n      submit.price[1] = Number(submit.price[1]);\r\n    } else submit.price.length = 1;\r\n    let { data } = await addItem({ variables: submit });\r\n    if (data.addItem) {\r\n      formDispatch({\r\n        type: 'RESET',\r\n      })\r\n      refresh();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <br/>\r\n      <Card className={classes.edit} style={{padding:5}}>\r\n        <Form formState={formState} updateForm={updateForm}/>\r\n        <Button size='small' onClick={()=>submitForm('')} style={{backgroundColor: 'lightblue', float: 'right'}}>ADD</Button>\r\n      </Card>\r\n    </>\r\n  )\r\n}\r\n\r\nconst handleScroll = ({ currentTarget }, onLoadMore) => {\r\n  if (\r\n    currentTarget.scrollTop + currentTarget.clientHeight >=\r\n    currentTarget.scrollHeight\r\n  ) {\r\n    onLoadMore();\r\n  }\r\n};\r\n\r\nconst ItemListDisplay = ({data, refetch, onLoadMore, isEdit}) => {\r\n  const [_, setRef] = useIntersect(async (entry, observer) => {\r\n    observer.unobserve(entry.target);\r\n    await onLoadMore();\r\n    observer.observe(entry.target);\r\n  }, {});\r\n  let itemList = data.batchItem\r\n  return (\r\n    <div>\r\n      <ul style={{padding: 0}}>\r\n        {itemList.map((item, i) => <TaoItem refresh={refetch} key={i} item={item} edit={isEdit}/>)}\r\n      </ul>\r\n      <div ref={setRef} className=\"Loading\">\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst ItemListHomeDisplay = () => {\r\n  const { loading, error, data, fetchMore, refetch } = useQuery(FEED_QUERY);\r\n  const location = useLocation();\r\n  const isEdit = !!(location.pathname === '/add')\r\n\r\n  let count = 0;\r\n  let prevCount;\r\n\r\n  return (\r\n      <>\r\n        {isEdit && <NewItem refresh={refetch}/>}\r\n        <br/>        \r\n        {(() => {\r\n          if (loading) return <div>로딩중..<br/>(최대 20초까지 소요)</div>\r\n          if (error) return <div>Error</div>\r\n          if (count === 0) count = data.batchItem.length\r\n          return <ItemListDisplay\r\n            data={data}\r\n            refetch={refetch}\r\n            isEdit={isEdit}\r\n            onLoadMore={async () => {\r\n              await fetchMore({\r\n                variables: {\r\n                  start: count\r\n                },\r\n                updateQuery: (prev, { fetchMoreResult }) => {\r\n                  if (!fetchMoreResult) return prev;\r\n                  prevCount = count;\r\n                  count += fetchMoreResult.batchItem.length;\r\n                  if (prevCount === count) return;\r\n                  return Object.assign({}, prev, {\r\n                    batchItem: [...prev.batchItem, ...fetchMoreResult.batchItem]\r\n                  });\r\n                }\r\n              }\r\n            )}}\r\n          />\r\n        })()}\r\n        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>\r\n      </>\r\n  )\r\n}\r\n\r\nexport { ItemListHomeDisplay };","import '../styles/App.css';\nimport { Box, Button, Container, createMuiTheme, ThemeProvider } from '@material-ui/core';\nimport { ItemListHomeDisplay } from './ItemListHomeDisplay';\nimport React, { useEffect, useState } from 'react';\nimport {\n  HashRouter,\n  Switch,\n  Route,\n  Redirect,\n  Link,\n  useLocation,\n} from \"react-router-dom\";\nimport { gql } from 'apollo-boost';\nimport { useMutation } from 'react-apollo';\nimport * as Cookies from 'js-cookie'\n\nconst theme = createMuiTheme({\n  typography: {\n    fontFamily: [\n      '-apple-system',\n      'BlinkMacSystemFont',\n      '\"Noto Sans KR\"',\n      '\"Segoe UI\"',\n      'Roboto',\n      '\"Helvetica Neue\"',\n      'Arial',\n      'sans-serif',\n      '\"Apple Color Emoji\"',\n      '\"Segoe UI Emoji\"',\n      '\"Segoe UI Symbol\"',\n    ].join(','),\n  },\n});\n\nconst AUTH_CHECK = gql`\n  mutation {\n    isLogin\n  }\n`\n\nconst LOGIN = gql`\n  mutation login($id: String!, $pw: String!) {\n    login(id: $id, pw: $pw) {\n      token\n      id\n    }\n  }\n`\n\nconst Login = () => {\n  \n  const [login] = useMutation(LOGIN);\n  async function loginRequest(e) {\n    e.preventDefault();\n    let res = await login({\n      variables: {\n        id: e.target.elements.username.value,\n        pw: e.target.elements.pwd.value,\n      },\n    });\n    if (!res.data.login) {\n      alert(\"잘못된 계정 정보입니다.\");\n    } else {\n      let expires = new Date();\n      expires.setTime(expires.getTime() + (60*60*1000));\n      Cookies.set('authorization', res.data.login.token, { path: '/',  expires})\n      window.location.href = \"/#/add\";\n    }\n  }\n  return (\n    <>\n      <div className=\"text-center\">\n        <form onSubmit={(d) => loginRequest(d)}>\n          <h3>로그인</h3>\n          <div className=\"form-group\">\n            <label>아이디</label>\n            <input\n              name=\"username\"\n              className=\"form-control\"\n              placeholder=\"아이디 입력\"\n            />\n          </div>\n\n          <div className=\"form-group\">\n            <label>비밀번호</label>\n            <input\n              name=\"pwd\"\n              type=\"password\"\n              className=\"form-control\"\n              placeholder=\"비밀번호 입력\"\n            />\n          </div>\n\n          <button type=\"submit\" className=\"btn btn-primary btn-block\">\n            확인\n          </button>\n        </form>\n      </div>\n    </>\n  );\n}\n\nexport const UserAuth = React.createContext(null);\n\nfunction App() {\n\n  const [authCheck] = useMutation(AUTH_CHECK);\n  const [auth, setAuth] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      let { data } = await authCheck();\n      setAuth(value => data.isLogin);\n    })();\n  }, []);\n\n  const Home = () => {\n    const location = useLocation();\n\n    return <>\n      <Container maxWidth=\"sm\" style={{ /*backgroundColor: '#cfe8fc',*/ height: '100vh', padding: 0 }}>\n        <Box style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: 10}}>\n          <h3>타오바오 잡템모음</h3>\n          <div>\n            <Button onClick={() => window.open('https://gall.dcinside.com/mgallery/board/lists?id=sff', \"_blank\")} style={{backgroundColor: '#F5C6C9'}}>SFF갤</Button>\n            &nbsp;&nbsp;\n            {auth\n              ? <Link to={location.pathname === '/add' ? '/' : '/add'}><Button style={{backgroundColor: '#eee'}}>수정</Button></Link>\n              : <Button onClick={() => window.open('https://forms.gle/38ejs1VSAT43YeEV6', \"_blank\")} style={{backgroundColor: '#c6e6f5'}}>추가 요청</Button>\n            }\n          </div>\n        </Box>\n        <ItemListHomeDisplay/>\n      </Container>\n    </>\n  }\n\n  return (\n    <ThemeProvider theme={theme}>\n      <div className=\"App\">\n        <UserAuth.Provider value={auth}>\n          <HashRouter>\n            <Switch>\n              <Route path=\"/\" exact={true} component={Home} />\n              {auth && <Route path=\"/add\" exact={true} component={Home} />}\n              <Route path=\"/login\" exact={true} component={Login} />\n              <Redirect to=\"/\" />\n            </Switch>\n          </HashRouter>\n        </UserAuth.Provider>\n      </div>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles/index.css';\nimport App from './components/App';\n\nimport { ApolloProvider } from 'react-apollo';\nimport { ApolloClient } from 'apollo-client';\nimport { createHttpLink } from 'apollo-link-http';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\n\nimport * as Cookies from 'js-cookie'\n\nlet authorization = Cookies.get('authorization')\n\nconst httpLink = createHttpLink({\n  uri: 'https://sff-taobao-items-backend.herokuapp.com',\n  credentials: 'same-origin',\n  headers: authorization\n  ? {\n      Authorization: `${authorization}`\n    }\n  : {}\n})\n\nconst client = new ApolloClient({\n  link: httpLink,\n  cache: new InMemoryCache()\n})\n\nReactDOM.render(\n  <ApolloProvider client={client}>\n    <App />\n  </ApolloProvider>,\n  document.getElementById('root')\n)"],"sourceRoot":""}